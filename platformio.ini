; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[common]
version = "2.1.5"
to_old_version = "1.5.10"

; Full library set (includes scale and display)
lib_deps =
    tzapu/WiFiManager @ ^2.0.17
    https://github.com/me-no-dev/ESPAsyncWebServer.git#master
    https://github.com/esphome/AsyncTCP.git
    bogde/HX711 @ ^0.7.5
    adafruit/Adafruit SSD1306 @ ^2.5.13
    adafruit/Adafruit GFX Library @ ^1.11.11
    adafruit/Adafruit PN532 @ ^1.3.3
    bblanchon/ArduinoJson @ ^7.3.0
    knolleary/PubSubClient @ ^2.8
    digitaldragon/SSLClient @ ^1.3.2

; Lite library set (NFC-only, no scale or display)
lib_deps_lite =
    tzapu/WiFiManager @ ^2.0.17
    https://github.com/me-no-dev/ESPAsyncWebServer.git#master
    https://github.com/esphome/AsyncTCP.git
    adafruit/Adafruit PN532 @ ^1.3.3
    bblanchon/ArduinoJson @ ^7.3.0
    knolleary/PubSubClient @ ^2.8
    digitaldragon/SSLClient @ ^1.3.2

build_flags =
    -Os
    -ffunction-sections
    -fdata-sections
    -DVERSION=\"${common.version}\"
    -DTOOLDVERSION=\"${common.to_old_version}\"
    -DASYNCWEBSERVER_REGEX
    -DCONFIG_ARDUHAL_LOG_COLORS=1
    -DCONFIG_OPTIMIZATION_LEVEL_DEBUG=1
    -DCONFIG_LWIP_TCP_MSL=60000
    -DCONFIG_LWIP_TCP_RCV_BUF_DEFAULT=4096
    -DCONFIG_LWIP_MAX_ACTIVE_TCP=16

; ── ESP32-WROOM-32D (38-pin) ──
;   PN532 SPI: SCK=18, MISO=19, MOSI=23, SS=5, IRQ=4, RST=27
[env:esp32-wroom-32d]
platform = platformio/espressif32@6.12.0
board = esp32dev
framework = arduino
monitor_speed = 115200
lib_deps = ${common.lib_deps}
board_build.filesystem = littlefs
board_build.partitions = partitions.csv
board_upload.flash_size = 4MB
board_build.flash_mode = dio
board_upload.flash_freq = "40m"
build_flags =
    ${common.build_flags}
    -mtext-section-literals
    -DBOOT_APP_PARTITION_OTA_0=1
    -DBOARD_NAME=\"ESP32-WROOM-32D\"
    -DDEFAULT_PN532_SCK=18
    -DDEFAULT_PN532_MISO=19
    -DDEFAULT_PN532_MOSI=23
    -DDEFAULT_PN532_SS=5
    -DDEFAULT_PN532_IRQ=4
    -DDEFAULT_PN532_RESET=27
extra_scripts =
    scripts/extra_script.py
    ${env:buildfs.extra_scripts}

; ── ESP32-WROOM-32D Lite (NFC only, no scale/display) ──
[env:esp32-wroom-32d-lite]
platform = platformio/espressif32@6.12.0
board = esp32dev
framework = arduino
monitor_speed = 115200
lib_deps = ${common.lib_deps_lite}
board_build.filesystem = littlefs
board_build.partitions = partitions.csv
board_upload.flash_size = 4MB
board_build.flash_mode = dio
board_upload.flash_freq = "40m"
build_flags =
    ${common.build_flags}
    -mtext-section-literals
    -DBOOT_APP_PARTITION_OTA_0=1
    -DBOARD_NAME=\"ESP32-WROOM-32D-Lite\"
    -DDEFAULT_PN532_SCK=18
    -DDEFAULT_PN532_MISO=19
    -DDEFAULT_PN532_MOSI=23
    -DDEFAULT_PN532_SS=5
    -DDEFAULT_PN532_IRQ=4
    -DDEFAULT_PN532_RESET=27
    -DDISABLE_SCALE
    -DDISABLE_DISPLAY
extra_scripts =
    scripts/extra_script.py
    ${env:buildfs.extra_scripts}

; ── ESP32-C3-Mini ──
;   PN532 SPI: SCK=4, MISO=5, MOSI=6, SS=7, IRQ=10, RST=3
[env:esp32-c3-mini]
platform = platformio/espressif32@6.12.0
board = esp32-c3-devkitm-1
framework = arduino
monitor_speed = 115200
lib_deps = ${common.lib_deps}
board_build.filesystem = littlefs
board_build.partitions = partitions.csv
board_upload.flash_size = 4MB
board_build.flash_mode = dio
build_flags =
    ${common.build_flags}
    -DBOARD_NAME=\"ESP32-C3-Mini\"
    -DDEFAULT_PN532_SCK=4
    -DDEFAULT_PN532_MISO=5
    -DDEFAULT_PN532_MOSI=6
    -DDEFAULT_PN532_SS=7
    -DDEFAULT_PN532_IRQ=10
    -DDEFAULT_PN532_RESET=3
extra_scripts =
    scripts/extra_script.py
    ${env:buildfs.extra_scripts}

; ── ESP32-C3-SuperMini ──
;   Same chip as C3-Mini, same default pins
;   PN532 SPI: SCK=4, MISO=5, MOSI=6, SS=7, IRQ=10, RST=3
[env:esp32-c3-supermini]
platform = platformio/espressif32@6.12.0
board = esp32-c3-devkitm-1
framework = arduino
monitor_speed = 115200
lib_deps = ${common.lib_deps}
board_build.filesystem = littlefs
board_build.partitions = partitions.csv
board_upload.flash_size = 4MB
board_build.flash_mode = dio
build_flags =
    ${common.build_flags}
    -DBOARD_NAME=\"ESP32-C3-SuperMini\"
    -DDEFAULT_PN532_SCK=4
    -DDEFAULT_PN532_MISO=5
    -DDEFAULT_PN532_MOSI=6
    -DDEFAULT_PN532_SS=7
    -DDEFAULT_PN532_IRQ=10
    -DDEFAULT_PN532_RESET=3
extra_scripts =
    scripts/extra_script.py
    ${env:buildfs.extra_scripts}

; ── ESP32-C3-SuperMini Lite (NFC only, no scale/display) ──
[env:esp32-c3-supermini-lite]
platform = platformio/espressif32@6.12.0
board = esp32-c3-devkitm-1
framework = arduino
monitor_speed = 115200
lib_deps = ${common.lib_deps_lite}
board_build.filesystem = littlefs
board_build.partitions = partitions.csv
board_upload.flash_size = 4MB
board_build.flash_mode = dio
build_flags =
    ${common.build_flags}
    -DBOARD_NAME=\"ESP32-C3-SuperMini-Lite\"
    -DDEFAULT_PN532_SCK=4
    -DDEFAULT_PN532_MISO=5
    -DDEFAULT_PN532_MOSI=6
    -DDEFAULT_PN532_SS=7
    -DDEFAULT_PN532_IRQ=10
    -DDEFAULT_PN532_RESET=3
    -DDISABLE_SCALE
    -DDISABLE_DISPLAY
extra_scripts =
    scripts/extra_script.py
    ${env:buildfs.extra_scripts}

; ── ESP32-C3-Mini Lite (NFC only, no scale/display) ──
[env:esp32-c3-mini-lite]
platform = platformio/espressif32@6.12.0
board = esp32-c3-devkitm-1
framework = arduino
monitor_speed = 115200
lib_deps = ${common.lib_deps_lite}
board_build.filesystem = littlefs
board_build.partitions = partitions.csv
board_upload.flash_size = 4MB
board_build.flash_mode = dio
build_flags =
    ${common.build_flags}
    -DBOARD_NAME=\"ESP32-C3-Mini-Lite\"
    -DDEFAULT_PN532_SCK=4
    -DDEFAULT_PN532_MISO=5
    -DDEFAULT_PN532_MOSI=6
    -DDEFAULT_PN532_SS=7
    -DDEFAULT_PN532_IRQ=10
    -DDEFAULT_PN532_RESET=3
    -DDISABLE_SCALE
    -DDISABLE_DISPLAY
extra_scripts =
    scripts/extra_script.py
    ${env:buildfs.extra_scripts}

; ── ESP32-C6-DevKit-1 (30-pin, experimental via pioarduino fork) ──
;   PN532 SPI: SCK=6, MISO=2, MOSI=7, SS=18, IRQ=19, RST=20
[env:esp32-c6-devkit]
platform = https://github.com/pioarduino/platform-espressif32.git#55.03.37
board = esp32-c6-devkitc-1
framework = arduino
monitor_speed = 115200
lib_deps =
    ${common.lib_deps}
    https://github.com/ESP32Async/AsyncTCP.git
lib_ignore =
    AsyncTCP-esphome
board_build.filesystem = littlefs
board_build.partitions = partitions.csv
board_upload.flash_size = 4MB
board_build.flash_mode = dio
build_flags =
    ${common.build_flags}
    -DBOARD_NAME=\"ESP32-C6-DevKit-1\"
    -DDEFAULT_PN532_SCK=6
    -DDEFAULT_PN532_MISO=2
    -DDEFAULT_PN532_MOSI=7
    -DDEFAULT_PN532_SS=18
    -DDEFAULT_PN532_IRQ=19
    -DDEFAULT_PN532_RESET=20
extra_scripts =
    scripts/extra_script.py
    ${env:buildfs.extra_scripts}

; ── ESP32-C6-DevKit-1 Lite (NFC only, no scale/display, experimental) ──
[env:esp32-c6-devkit-lite]
platform = https://github.com/pioarduino/platform-espressif32.git#55.03.37
board = esp32-c6-devkitc-1
framework = arduino
monitor_speed = 115200
lib_deps =
    ${common.lib_deps_lite}
    https://github.com/ESP32Async/AsyncTCP.git
lib_ignore =
    AsyncTCP-esphome
board_build.filesystem = littlefs
board_build.partitions = partitions.csv
board_upload.flash_size = 4MB
board_build.flash_mode = dio
build_flags =
    ${common.build_flags}
    -DBOARD_NAME=\"ESP32-C6-DevKit-1-Lite\"
    -DDEFAULT_PN532_SCK=6
    -DDEFAULT_PN532_MISO=2
    -DDEFAULT_PN532_MOSI=7
    -DDEFAULT_PN532_SS=18
    -DDEFAULT_PN532_IRQ=19
    -DDEFAULT_PN532_RESET=20
    -DDISABLE_SCALE
    -DDISABLE_DISPLAY
extra_scripts =
    scripts/extra_script.py
    ${env:buildfs.extra_scripts}

[env:buildfs]
extra_scripts =
    pre:scripts/combine_html.py  ; Combine header with HTML files
    scripts/gzip_files.py       ; Compress files for SPIFFS

[platformio]
default_envs = esp32-wroom-32d
